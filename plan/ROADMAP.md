めぐりび / MEGRIBI — ROADMAP

最終更新: 2025-11-22
対象ブランチ: main
前提: plan/ONBOARDING.md, plan/ARCHITECTURE.md の内容と整合させること

0. このドキュメントの目的

この ROADMAP は、めぐりび / MEGRIBI プロジェクトの

どこまで出来ているか（進捗）

これからどの順番で作業していくか（優先度）

バックエンド / データ基盤 / フロント / ブランドまわりが、どのバージョンでどこまで到達しているか

を一枚で把握できるようにするためのメモです。

「次の ChatGPT / gpt5codex / 将来の自分」がこのファイルだけ見れば、

いま何を最優先にやるべきか（= Supabase 38 店舗自動収集まわり）

その次にやるべきこと（Supabase への一本化 → 複数店舗ダッシュボード → ドメイン/ブランド）

さらにその先のアイデア（周辺の二次会スポット、PWA 通知など）

が迷わず分かるようにするのがゴールです。

1. 優先度レベルの定義

作業アイテムには、以下の優先度ラベルを付けます。

P0: いま最優先でやること

これをやらないと、他の作業をしてもあまり意味がないもの

例: Supabase での 38 店舗自動収集の安定稼働、Supabase へのデータソース切り替え など

P1: P0 が落ち着いたらすぐ着手したいもの

コア体験に直結し、サービスとしての「めぐりび」の骨格になる部分

例: 複数店舗ダッシュボード、マルチ店舗対応の予測モデル、独自ドメインの設定 など

P2: 基本が出来たあとに強化していくもの

UX の向上や、運用を楽にする機能

例: ブランド・コピーのブラッシュアップ、ログ可視化ツール、簡易管理画面 など

P3: 余裕ができたらトライしたいアイデア枠

なくてもサービスは回るが、「めぐりびらしさ」を強くするオプション

例: 周辺の二次会スポット表示、PWA 通知、LINE 通知の再検討 など

2. 現在の進捗マップ（2025-11-22 時点）

ざっくり現在地を整理した表です。

フェーズ	内容	状態	完了度	優先度
v0.1	Google スプレッドシート + GAS ルート（長崎店単一）	✅ 本番稼働済み（今後はバックアップ用途）	100%	P3（レガシー）
v0.2	Next.js ダッシュボード（単一店舗プレビュー）	🚧 UI プレビュー画面まで実装	約60%	P1
v0.3	Supabase テーブル設計（stores, logs など）	✅ 38 店舗分のスキーマ設計と初期データ登録は完了	100%	P1
v0.3	Supabase 38 店舗自動データ収集（天気込み）	⚙️ 試験中（multi_collect による並列収集）	約70%	P0（最優先）
v0.4	Supabase への完全移行（データソース一本化）	🕐 未着手（設計のみ）	0%	P0
v0.4	複数店舗ダッシュボード（一覧＋店舗別＋予測プレビュー）	🚧 UI の土台はあり、API 連携前	約40%	P1
v0.5	予測モデルの整理（Supabase からの再学習 / マルチ店舗）	🕐 企画中（XGBoost 実装済み、再設計が必要）	約20%	P1
v0.5	独自ドメイン meguribi.com + ブランド周り調整	🕐 未着手（方針は決定）	0%	P2（ただし Supabase 作業完了後すぐにやりたい）
v0.6	周辺の二次会スポット表示（カラオケ・ダーツ・ホテル・ラーメン等）	🕐 アイデア段階（UI プレビューのみ）	0%	P3
v0.6	PWA 化 & Web 通知（ホーム画面追加での擬似通知）	🕐 調査前	0%	P3
将来	LINE 通知（Messaging API）	⏸ コストの観点から一旦保留	0%	P3 / 要再検討

ポイント:

シート + GAS ルートは 動いてはいるが、今後はバックアップ用 として扱う（本命は Supabase）。

今いちばん重要なのは
「Supabase で 38 店舗 + 天気を安定して集める」→「Supabase を本番の唯一のデータソースにする」 という流れ。

UI や独自ドメイン、通知まわりは その後でじっくり 進めれば OK。

3. 直近のゴール（P0）: Supabase 38 店舗基盤の完成
P0-1. Supabase 38 店舗自動収集の安定化（v0.3）

目的:
GAS / シートに頼らず、Supabase 単体で 38 店舗の来店人数 + 天気を記録できる状態にする。

やること:

multi_collect の安定化

各店舗のスクレイピング / API 取得が、タイムアウトや一部失敗時でも全体に影響しないようにする。

失敗時のリトライ戦略（例: 1 回だけリトライ、ダメならエラーログに書いて次へ進む）。

ログ出力を整理（どの店舗で、どんなエラーが起きたかをすぐ把握できるように）。

Supabase logs テーブルへの書き込み確認

38 店舗すべてについて、定期的にレコードが増えていることを確認。

store_id, ts, men, women, total, weather_code など、必要な列がちゃんと埋まっているかをチェック。

テスト用クエリ（例: 「直近 24 時間の各店舗の件数」など）を plan/requests.http に追記しておくとよい。

モニタリングの簡易仕組み

毎日 1 回、「昨日 1 日で店舗ごとのレコード件数」を見る簡単な SQL や HTTP エンドポイントを用意。

想定件数と大きくズレていたら異常とみなせるようにしておく（長期運用のための最低限）。

P0-2. Supabase への一本化（v0.4）

目的:
「本番の表示 / 予測」も含めて、すべて Supabase を唯一のソース・オブ・トゥルースにする。

やること:

バックエンド API のデータソース切り替え

現在 JSON / シートから読んでいる range 系 API を、Supabase から読むように変更。

フィルタ条件（store, from, to, limit など）は今の API 契約を維持したまま、裏側だけ差し替えるイメージ。

tests/test_range_params.py が落ちないように注意しながら実装。

旧ルート（GAS / シート）の役割を「バックアップ専用」に変更

コード内のフラグ（例: gs_read, gs_webhook）を整理し、「通常は Supabase を使う」設定をデフォルトに。

将来、何かあった時に一時的にシート側に戻せるよう、大枠は残しておく。

本番環境でのデグレ確認

Supabase 切り替え後に、以前の JSON / シートベースとグラフの形が大きく変わっていないかを確認。

最低 1〜2 週間は、旧ルートのデータと Supabase のデータを簡単に比較できる仕組み（簡易スクリプトなど）を用意すると安心。

4. P1: 複数店舗ダッシュボード + 予測モデル + ドメイン

Supabase 基盤が落ち着いたら、一気に「サービスとしての顔」を整えるフェーズです。

P1-1. 複数店舗ダッシュボード（v0.4）

目的:
ユーザーが「どの店に行くか」を選べるようにする、めぐりびの中核 UI。

やること:

店舗一覧ページ

Supabase stores テーブルから店舗情報を取得。

距離順 / 営業終了時間が遅い順 などのソート切り替え。

いまの UI プレビュー（React のカード一覧）をベースに、実データを流し込む。

店舗別ページ

/stores/[id] に、来店人数のグラフ + 直近 1 時間の予測グラフを表示。

既存のグラフコンポーネント（予測プレビュー）を流用し、API を Supabase 対応版に切り替え。

API との接続

フロントのフェッチ先を、Supabase 対応済みのバックエンド API に向ける。

キャッシュやローディング表示など、最低限の UX を調整。

P1-2. 予測モデルの整理（v0.5）

目的:
単一店舗向けに作った XGBoost モデルを、「複数店舗＋Supabase データ」に対応した形で再設計する。

やること:

特徴量の整理

Supabase の logs から「店舗 ID」「時間帯」「曜日」「天気」などを取り出し、学習データにする。

10 分間隔 / 15 分間隔をどうするか（方針を一度決める）。

モデル構成の検討

店舗ごとにローカルモデルを持つか（例: 長崎店モデル、渋谷店モデル…）
それとも、「店舗 ID を特徴量に含めたグローバルモデル」を 1 つ持つか。

当面は メンテコストの低い構成 を優先する（精度は 3 ヶ月後でも良い）。

学習スクリプトの Supabase 対応

既存の train_local.py 相当のスクリプトを、Supabase から直接データを引いて学習する形に修正。

週 1 回のバッチ実行（ローカル PC or 一時ワーカー）を想定。

P1-3. 独自ドメイン meguribi.com + ブランド整備（v0.5）

目的:
「めぐりび」という世界観とサービス名をはっきりさせ、ユーザーに覚えてもらえる形にする。

やること:

ドメイン取得と接続

meguribi.com を取得（仮から本番へ）。

Render / Vercel 側でカスタムドメインの設定。

HTTPS 化の確認。

表側の文言やロゴの最小セット

ヘッダーやフッターに「めぐりび / MEGRIBI」のロゴと簡単なタグラインを表示。

「公式ではないが、夜の地図を少しだけ照らす案内灯」という立ち位置を、短い文章で説明。

SEO / SNS の最低限の対応

タイトルタグ・メタディスクリプションを設定。

OGP 画像（仮でも良い）を用意。

5. P2: 運用・体験の強化

Supabase 基盤・複数店舗 UI・予測モデル・ドメインまで整ったあとで、余裕を見ながら進めたい部分。

例:

ログ可視化ツール

管理者向けに、どの店舗でデータが途切れているかを一覧できる簡易画面。

異常検知

想定値から大きく逸脱したときに、Slack などに通知する仕組み（まずは簡易なもの）。

記事コンテンツ

「相席ラウンジの上手な使い方」「混みやすい曜日・時間帯」などのコラムを作り、SEO / SNS から人を連れてくる。

6. P3: 体験拡張アイデア（周辺スポット + PWA 通知など）

ここは 「めぐりびの世界観を広げる」ための遊び場 です。
必須ではないけれど、出来るとかなり面白くなる部分。

P3-1. 周辺の二次会スポット表示

目的:
「めぐりびを開いておけば、その日の夜の動き方が一通りイメージできる」状態にする。

機能イメージ:

対象店舗（例: オリエンタルラウンジ長崎店）の近くにある

カラオケ

ダーツバー

ホテル

ラーメン屋

などをカード形式で表示。

現在は静的なダミーデータで UI プレビュー済み。
将来的には外部 API（Google Places 等）から取得するか、手動で「おすすめリスト」を作るかは要検討。

P3-2. PWA 化 & Web 通知（ホーム画面追加を前提）

目的:
LINE のような有料メッセージングは避けつつ、
「iPhone のホーム画面に追加しておくだけで、混み具合の通知が届く」体験を目指す。

やることの方向性:

PWA 対応

マニフェスト（manifest.json）の作成。

Service Worker の導入。

iOS / Android の Web プッシュ通知の制約を整理

iOS Safari では、ホーム画面追加したサイトに対してのみ通知が可能…などの仕様を確認。

第一歩としては

「毎晩 18:00 に“今日の長崎店の混み度”を通知する」といった、シンプルな通知から始める。

P3-3. LINE 通知の再検討（保留）

現時点では コストがかかるため保留。

ユーザー数が増えたり、どうしても必要になった場合に再検討する。

7. このファイルの使い方

新しい機能を思いついたら、まずはこの ROADMAP の

どのフェーズに入るか

どの優先度（P0〜P3）か
を決めてから追記する。

大きな方向転換（例: 「やはり LINE 通知をやる」「Supabase 以外の DB を使う」など）があれば、

ONBOARDING.md / ARCHITECTURE.md と合わせて、ここにも必ずメモする。

「次の ChatGPT に話しかけるとき」は、

まずこの ROADMAP.md の最新内容をアップロードしてから、

「いまは P0 のこの部分を進めたい」と伝えるとスムーズ。